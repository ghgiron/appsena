{"ast":null,"code":"import FuseUtils from '@fuse/utils';\nimport _ from '@lodash';\nimport jwt from 'jsonwebtoken';\nimport mock from '../mock';\n/* eslint-disable camelcase */\n\nconst jwtConfig = {\n  secret: 'some-secret-code-goes-here',\n  expiresIn: '2 days' // A numeric value is interpreted as a seconds count. If you use a string be sure you provide the time units (days, hours, etc)\n\n};\nconst authDB = {\n  users: [{\n    uuid: 'XgbuVEXBU5gtSKdbQRP1Zbbby1i1',\n    from: 'custom-db',\n    password: 'admin',\n    role: 'admin',\n    data: {\n      displayName: 'Abbott Keitch',\n      photoURL: 'assets/images/avatars/Abbott.jpg',\n      email: 'admin',\n      settings: {\n        layout: {\n          style: 'layout2',\n          config: {\n            scroll: 'content',\n            navbar: {\n              display: true,\n              folded: true,\n              position: 'left'\n            },\n            toolbar: {\n              display: true,\n              style: 'fixed',\n              position: 'below'\n            },\n            footer: {\n              display: false,\n              style: 'fixed',\n              position: 'below'\n            },\n            mode: 'fullwidth'\n          }\n        },\n        customScrollbars: true\n        /* \ttheme: {\n        \t\tmain: 'defaultDark',\n        \t\tnavbar: 'defaultDark',\n        \t\ttoolbar: 'defaultDark',\n        \t\tfooter: 'defaultDark'\n        \t} */\n\n      } //\tshortcuts: ['calendar', 'mail', 'contacts']\n\n    }\n  }\n  /* \t{\n  \t\tuuid: 'XgbuVEXBU6gtSKdbTYR1Zbbby1i3',\n  \t\tfrom: 'custom-db',\n  \t\tpassword: 'staff',\n  \t\trole: 'staff',\n  \t\tdata: {\n  \t\t\tdisplayName: 'Arnold Matlock111',\n  \t\t\tphotoURL: 'assets/images/avatars/Arnold.jpg',\n  \t\t\temail: 'staff',\n  \t\t\tsettings: {\n  \t\t\t\tlayout: {\n  \t\t\t\t\tstyle: 'layout2',\n  \t\t\t\t\tconfig: {\n  \t\t\t\t\t\tmode: 'boxed',\n  \t\t\t\t\t\tscroll: 'content',\n  \t\t\t\t\t\tnavbar: {\n  \t\t\t\t\t\t\tdisplay: true\n  \t\t\t\t\t\t},\n  \t\t\t\t\t\ttoolbar: {\n  \t\t\t\t\t\t\tdisplay: true,\n  \t\t\t\t\t\t\tposition: 'below'\n  \t\t\t\t\t\t},\n  \t\t\t\t\t\tfooter: {\n  \t\t\t\t\t\t\tdisplay: true,\n  \t\t\t\t\t\t\tstyle: 'fixed'\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t},\n  \t\t\t\tcustomScrollbars: true,\n  \t\t\t\ttheme: {\n  \t\t\t\t\tmain: 'greeny',\n  \t\t\t\t\tnavbar: 'mainThemeDark',\n  \t\t\t\t\ttoolbar: 'mainThemeDark',\n  \t\t\t\t\tfooter: 'mainThemeDark'\n  \t\t\t\t}\n  \t\t\t},\n  \t\t\tshortcuts: ['calendar', 'mail', 'contacts', 'todo']\n  \t\t}\n  \t} */\n  ]\n};\nmock.onGet('/api/auth').reply(config => {\n  const data = JSON.parse(config.data);\n  const {\n    email,\n    password\n  } = data;\n\n  const user = _.cloneDeep(authDB.users.find(_user => _user.data.email === email));\n\n  const error = {\n    email: user ? null : 'Check your username/email',\n    password: user && user.password === password ? null : 'Check your password'\n  };\n\n  if (!error.email && !error.password && !error.displayName) {\n    delete user.password;\n    const access_token = jwt.sign({\n      id: user.uuid\n    }, jwtConfig.secret, {\n      expiresIn: jwtConfig.expiresIn\n    });\n    const response = {\n      user,\n      access_token\n    };\n    return [200, response];\n  }\n\n  return [200, {\n    error\n  }];\n});\nmock.onGet('/api/auth/access-token').reply(config => {\n  const data = JSON.parse(config.data);\n  const {\n    access_token\n  } = data;\n\n  try {\n    const {\n      id\n    } = jwt.verify(access_token, jwtConfig.secret);\n\n    const user = _.cloneDeep(authDB.users.find(_user => _user.uuid === id));\n\n    delete user.password;\n    const updatedAccessToken = jwt.sign({\n      id: user.uuid\n    }, jwtConfig.secret, {\n      expiresIn: jwtConfig.expiresIn\n    });\n    const response = {\n      user,\n      access_token: updatedAccessToken\n    };\n    return [200, response];\n  } catch (e) {\n    const error = 'Invalid access token detected';\n    return [401, {\n      error\n    }];\n  }\n});\nmock.onPost('/api/auth/register').reply(request => {\n  const data = JSON.parse(request.data);\n  const {\n    displayName,\n    password,\n    email\n  } = data;\n  const isEmailExists = authDB.users.find(_user => _user.data.email === email);\n  const error = {\n    email: isEmailExists ? 'The email is already in use' : null,\n    displayName: displayName !== '' ? null : 'Enter display name',\n    password: null\n  };\n\n  if (!error.displayName && !error.password && !error.email) {\n    const newUser = {\n      uuid: FuseUtils.generateGUID(),\n      from: 'custom-db',\n      password,\n      role: 'admin',\n      data: {\n        displayName,\n        photoURL: 'assets/images/avatars/Abbott.jpg',\n        email,\n        settings: {},\n        shortcuts: []\n      }\n    };\n    authDB.users = [...authDB.users, newUser];\n\n    const user = _.cloneDeep(newUser);\n\n    delete user.password;\n    const access_token = jwt.sign({\n      id: user.uuid\n    }, jwtConfig.secret, {\n      expiresIn: jwtConfig.expiresIn\n    });\n    const response = {\n      user,\n      access_token\n    };\n    return [200, response];\n  }\n\n  return [200, {\n    error\n  }];\n});\nmock.onPost('/api/auth/user/update').reply(config => {\n  const data = JSON.parse(config.data);\n  const {\n    user\n  } = data;\n  authDB.users = authDB.users.map(_user => {\n    if (user.uuid === user.id) {\n      return _.merge(_user, user);\n    }\n\n    return _user;\n  });\n  return [200, user];\n});","map":{"version":3,"sources":["D:/proyectos_react/Proyecto_sena/src/@fake-db/db/auth-db.js"],"names":["FuseUtils","_","jwt","mock","jwtConfig","secret","expiresIn","authDB","users","uuid","from","password","role","data","displayName","photoURL","email","settings","layout","style","config","scroll","navbar","display","folded","position","toolbar","footer","mode","customScrollbars","onGet","reply","JSON","parse","user","cloneDeep","find","_user","error","access_token","sign","id","response","verify","updatedAccessToken","e","onPost","request","isEmailExists","newUser","generateGUID","shortcuts","map","merge"],"mappings":"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","sourcesContent":["import FuseUtils from '@fuse/utils';\nimport _ from '@lodash';\nimport jwt from 'jsonwebtoken';\nimport mock from '../mock';\n/* eslint-disable camelcase */\n\nconst jwtConfig = {\n\tsecret: 'some-secret-code-goes-here',\n\texpiresIn: '2 days' // A numeric value is interpreted as a seconds count. If you use a string be sure you provide the time units (days, hours, etc)\n};\n\nconst authDB = {\n\tusers: [\n\t\t{\n\t\t\tuuid: 'XgbuVEXBU5gtSKdbQRP1Zbbby1i1',\n\t\t\tfrom: 'custom-db',\n\t\t\tpassword: 'admin',\n\t\t\trole: 'admin',\n\t\t\tdata: {\n\t\t\t\tdisplayName: 'Abbott Keitch',\n\t\t\t\tphotoURL: 'assets/images/avatars/Abbott.jpg',\n\t\t\t\temail: 'admin',\n\t\t\t\tsettings: {\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\tstyle: 'layout2',\n\t\t\t\t\t\tconfig: {\n\t\t\t\t\t\t\tscroll: 'content',\n\t\t\t\t\t\t\tnavbar: {\n\t\t\t\t\t\t\t\tdisplay: true,\n\t\t\t\t\t\t\t\tfolded: true,\n\t\t\t\t\t\t\t\tposition: 'left'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttoolbar: {\n\t\t\t\t\t\t\t\tdisplay: true,\n\t\t\t\t\t\t\t\tstyle: 'fixed',\n\t\t\t\t\t\t\t\tposition: 'below'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfooter: {\n\t\t\t\t\t\t\t\tdisplay: false,\n\t\t\t\t\t\t\t\tstyle: 'fixed',\n\t\t\t\t\t\t\t\tposition: 'below'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmode: 'fullwidth'\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcustomScrollbars: true,\n\t\t\t\t/* \ttheme: {\n\t\t\t\t\t\tmain: 'defaultDark',\n\t\t\t\t\t\tnavbar: 'defaultDark',\n\t\t\t\t\t\ttoolbar: 'defaultDark',\n\t\t\t\t\t\tfooter: 'defaultDark'\n\t\t\t\t\t} */\n\t\t\t\t},\n\t\t\t//\tshortcuts: ['calendar', 'mail', 'contacts']\n\t\t\t}\n\t\t},\n\t/* \t{\n\t\t\tuuid: 'XgbuVEXBU6gtSKdbTYR1Zbbby1i3',\n\t\t\tfrom: 'custom-db',\n\t\t\tpassword: 'staff',\n\t\t\trole: 'staff',\n\t\t\tdata: {\n\t\t\t\tdisplayName: 'Arnold Matlock111',\n\t\t\t\tphotoURL: 'assets/images/avatars/Arnold.jpg',\n\t\t\t\temail: 'staff',\n\t\t\t\tsettings: {\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\tstyle: 'layout2',\n\t\t\t\t\t\tconfig: {\n\t\t\t\t\t\t\tmode: 'boxed',\n\t\t\t\t\t\t\tscroll: 'content',\n\t\t\t\t\t\t\tnavbar: {\n\t\t\t\t\t\t\t\tdisplay: true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttoolbar: {\n\t\t\t\t\t\t\t\tdisplay: true,\n\t\t\t\t\t\t\t\tposition: 'below'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfooter: {\n\t\t\t\t\t\t\t\tdisplay: true,\n\t\t\t\t\t\t\t\tstyle: 'fixed'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcustomScrollbars: true,\n\t\t\t\t\ttheme: {\n\t\t\t\t\t\tmain: 'greeny',\n\t\t\t\t\t\tnavbar: 'mainThemeDark',\n\t\t\t\t\t\ttoolbar: 'mainThemeDark',\n\t\t\t\t\t\tfooter: 'mainThemeDark'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tshortcuts: ['calendar', 'mail', 'contacts', 'todo']\n\t\t\t}\n\t\t} */\n\t]\n};\n\nmock.onGet('/api/auth').reply(config => {\n\tconst data = JSON.parse(config.data);\n\tconst { email, password } = data;\n\n\tconst user = _.cloneDeep(authDB.users.find(_user => _user.data.email === email));\n\n\tconst error = {\n\t\temail: user ? null : 'Check your username/email',\n\t\tpassword: user && user.password === password ? null : 'Check your password'\n\t};\n\n\tif (!error.email && !error.password && !error.displayName) {\n\t\tdelete user.password;\n\n\t\tconst access_token = jwt.sign({ id: user.uuid }, jwtConfig.secret, { expiresIn: jwtConfig.expiresIn });\n\n\t\tconst response = {\n\t\t\tuser,\n\t\t\taccess_token\n\t\t};\n\n\t\treturn [200, response];\n\t}\n\treturn [200, { error }];\n});\n\nmock.onGet('/api/auth/access-token').reply(config => {\n\tconst data = JSON.parse(config.data);\n\tconst { access_token } = data;\n\n\ttry {\n\t\tconst { id } = jwt.verify(access_token, jwtConfig.secret);\n\n\t\tconst user = _.cloneDeep(authDB.users.find(_user => _user.uuid === id));\n\t\tdelete user.password;\n\n\t\tconst updatedAccessToken = jwt.sign({ id: user.uuid }, jwtConfig.secret, { expiresIn: jwtConfig.expiresIn });\n\n\t\tconst response = {\n\t\t\tuser,\n\t\t\taccess_token: updatedAccessToken\n\t\t};\n\n\t\treturn [200, response];\n\t} catch (e) {\n\t\tconst error = 'Invalid access token detected';\n\t\treturn [401, { error }];\n\t}\n});\n\nmock.onPost('/api/auth/register').reply(request => {\n\tconst data = JSON.parse(request.data);\n\tconst { displayName, password, email } = data;\n\tconst isEmailExists = authDB.users.find(_user => _user.data.email === email);\n\tconst error = {\n\t\temail: isEmailExists ? 'The email is already in use' : null,\n\t\tdisplayName: displayName !== '' ? null : 'Enter display name',\n\t\tpassword: null\n\t};\n\tif (!error.displayName && !error.password && !error.email) {\n\t\tconst newUser = {\n\t\t\tuuid: FuseUtils.generateGUID(),\n\t\t\tfrom: 'custom-db',\n\t\t\tpassword,\n\t\t\trole: 'admin',\n\t\t\tdata: {\n\t\t\t\tdisplayName,\n\t\t\t\tphotoURL: 'assets/images/avatars/Abbott.jpg',\n\t\t\t\temail,\n\t\t\t\tsettings: {},\n\t\t\t\tshortcuts: []\n\t\t\t}\n\t\t};\n\n\t\tauthDB.users = [...authDB.users, newUser];\n\n\t\tconst user = _.cloneDeep(newUser);\n\t\tdelete user.password;\n\n\t\tconst access_token = jwt.sign({ id: user.uuid }, jwtConfig.secret, { expiresIn: jwtConfig.expiresIn });\n\n\t\tconst response = {\n\t\t\tuser,\n\t\t\taccess_token\n\t\t};\n\n\t\treturn [200, response];\n\t}\n\treturn [200, { error }];\n});\n\nmock.onPost('/api/auth/user/update').reply(config => {\n\tconst data = JSON.parse(config.data);\n\tconst { user } = data;\n\n\tauthDB.users = authDB.users.map(_user => {\n\t\tif (user.uuid === user.id) {\n\t\t\treturn _.merge(_user, user);\n\t\t}\n\t\treturn _user;\n\t});\n\n\treturn [200, user];\n});\n"]},"metadata":{},"sourceType":"module"}