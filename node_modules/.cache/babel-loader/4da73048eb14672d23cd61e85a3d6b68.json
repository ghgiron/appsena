{"ast":null,"code":"import FuseUtils from '@fuse/utils/FuseUtils';\nimport axios from 'axios';\nimport jwtDecode from 'jwt-decode';\n/* eslint-disable camelcase */\n\nclass JwtService extends FuseUtils.EventEmitter {\n  constructor(...args) {\n    super(...args);\n\n    this.setInterceptors = () => {\n      axios.interceptors.response.use(response => {\n        return response;\n      }, err => {\n        return new Promise((resolve, reject) => {\n          //if (err.response.status === 401 && err.config && !err.config.__isRetryRequest) {\n          if (err.response.status === 401) {\n            // if you ever get an unauthorized response, logout the user\n            this.emit('onAutoLogout', 'Invalid access_token');\n            this.setSession(null);\n          }\n\n          throw err;\n        });\n      });\n    };\n\n    this.handleAuthentication = () => {\n      const access_token = this.getAccessToken();\n\n      if (!access_token) {\n        this.emit('onNoAccessToken');\n        return;\n      }\n\n      if (this.isAuthTokenValid(access_token)) {\n        this.setSession(access_token);\n        this.emit('onAutoLogin', true);\n      } else {\n        this.setSession(null);\n        this.emit('onAutoLogout', 'access_token expired');\n      }\n    };\n\n    this.createUser = data => {\n      return new Promise((resolve, reject) => {\n        axios.post('/api/auth/register', data).then(response => {\n          if (response.data.user) {\n            this.setSession(response.data.access_token);\n            resolve(response.data.user);\n          } else {\n            reject(response.data.error);\n          }\n        });\n      });\n    };\n\n    this.signInWithEmailAndPassword = (users, password) => {\n      return new Promise((resolve, reject) => {\n        axios.post('http://senova.com/auth/login', {\n          data: {\n            users,\n            password\n          }\n        }).then(response => {\n          if (response.data.user) {\n            this.setSession(response.data.access_token);\n            resolve(response.data.user);\n          } else {\n            reject(response.data.error);\n          }\n        });\n      });\n    };\n\n    this.signInWithToken = () => {\n      return new Promise((resolve, reject) => {\n        axios.get('/api/auth/access-token', {\n          data: {\n            access_token: this.getAccessToken()\n          }\n        }).then(response => {\n          if (response.data.user) {\n            this.setSession(response.data.access_token);\n            resolve(response.data.user);\n          } else {\n            this.logout();\n            reject(new Error('Failed to login with token.'));\n          }\n        }).catch(error => {\n          this.logout();\n          reject(new Error('Failed to login with token.'));\n        });\n      });\n    };\n\n    this.updateUserData = user => {\n      return axios.post('/api/auth/user/update', {\n        user\n      });\n    };\n\n    this.setSession = access_token => {\n      if (access_token) {\n        localStorage.setItem('jwt_access_token', access_token);\n        axios.defaults.headers.common.Authorization = `Bearer ${access_token}`;\n      } else {\n        localStorage.removeItem('jwt_access_token');\n        delete axios.defaults.headers.common.Authorization;\n      }\n    };\n\n    this.logout = () => {\n      this.setSession(null);\n    };\n\n    this.isAuthTokenValid = access_token => {\n      if (!access_token) {\n        return false;\n      }\n\n      const decoded = jwtDecode(access_token);\n      const currentTime = Date.now() / 1000;\n\n      if (decoded.exp < currentTime) {\n        console.warn('access token expired');\n        return false;\n      }\n\n      return true;\n    };\n\n    this.getAccessToken = () => {\n      return window.localStorage.getItem('jwt_access_token');\n    };\n  }\n\n  init() {\n    this.setInterceptors();\n    this.handleAuthentication();\n  }\n\n}\n\nconst instance = new JwtService();\nexport default instance;","map":{"version":3,"sources":["D:/proyectos_react/Proyecto_sena_desarrollo/src/app/services/jwtService/jwtService.js"],"names":["FuseUtils","axios","jwtDecode","JwtService","EventEmitter","setInterceptors","interceptors","response","use","err","Promise","resolve","reject","status","emit","setSession","handleAuthentication","access_token","getAccessToken","isAuthTokenValid","createUser","data","post","then","user","error","signInWithEmailAndPassword","users","password","signInWithToken","get","logout","Error","catch","updateUserData","localStorage","setItem","defaults","headers","common","Authorization","removeItem","decoded","currentTime","Date","now","exp","console","warn","window","getItem","init","instance"],"mappings":"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","sourcesContent":["import FuseUtils from '@fuse/utils/FuseUtils';\nimport axios from 'axios';\nimport jwtDecode from 'jwt-decode';\n/* eslint-disable camelcase */\n\nclass JwtService extends FuseUtils.EventEmitter {\n\tinit() {\n\t\tthis.setInterceptors();\n\t\tthis.handleAuthentication();\n\t}\n\n \tsetInterceptors = () => {\n\t\taxios.interceptors.response.use(\n\t\t\tresponse => {\n\t\t\t\treturn response;\n\t\t\t},\n\t\t\terr => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t//if (err.response.status === 401 && err.config && !err.config.__isRetryRequest) {\n\t\t\t\t\tif (err.response.status === 401) {\n\t\t\t\t\t\t// if you ever get an unauthorized response, logout the user\n\t\t\t\t\t\tthis.emit('onAutoLogout', 'Invalid access_token');\n\t\t\t\t\t\tthis.setSession(null);\n\t\t\t\t\t}\n\t\t\t\t\tthrow err;\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}; \n\n\thandleAuthentication = () => {\n\t\tconst access_token = this.getAccessToken();\n\n\t\tif (!access_token) {\n\t\t\tthis.emit('onNoAccessToken');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isAuthTokenValid(access_token)) {\n\t\t\tthis.setSession(access_token);\n\t\t\tthis.emit('onAutoLogin', true);\n\t\t} else {\n\t\t\tthis.setSession(null);\n\t\t\tthis.emit('onAutoLogout', 'access_token expired');\n\t\t}\n\t};\n\n\tcreateUser = data => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\taxios.post('/api/auth/register', data).then(response => {\n\t\t\t\tif (response.data.user) {\n\t\t\t\t\tthis.setSession(response.data.access_token);\n\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t} else {\n\t\t\t\t\treject(response.data.error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tsignInWithEmailAndPassword = (users, password) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\taxios.post('http://senova.com/auth/login', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t    users,\n\t\t\t\t\t\tpassword\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (response.data.user) {\n\t\t\t\t\t\tthis.setSession(response.data.access_token);\n\t\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t};\n\n\tsignInWithToken = () => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\taxios\n\t\t\t\t.get('/api/auth/access-token', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taccess_token: this.getAccessToken()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (response.data.user) {\n\t\t\t\t\t\tthis.setSession(response.data.access_token);\n\t\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.logout();\n\t\t\t\t\t\treject(new Error('Failed to login with token.'));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\tthis.logout();\n\t\t\t\t\treject(new Error('Failed to login with token.'));\n\t\t\t\t});\n\t\t});\n\t};\n\n\tupdateUserData = user => {\n\t\treturn axios.post('/api/auth/user/update', {\n\t\t\tuser\n\t\t});\n\t};\n\n\tsetSession = access_token => {\n\t\tif (access_token) {\n\t\t\tlocalStorage.setItem('jwt_access_token', access_token);\n\t\t\taxios.defaults.headers.common.Authorization = `Bearer ${access_token}`;\n\t\t} else {\n\t\t\tlocalStorage.removeItem('jwt_access_token');\n\t\t\tdelete axios.defaults.headers.common.Authorization;\n\t\t}\n\t};\n\n\tlogout = () => {\n\t\tthis.setSession(null);\n\t};\n\n\tisAuthTokenValid = access_token => {\n\t\tif (!access_token) {\n\t\t\treturn false;\n\t\t}\n\t\tconst decoded = jwtDecode(access_token);\n\t\tconst currentTime = Date.now() / 1000;\n\t\tif (decoded.exp < currentTime) {\n\t\t\tconsole.warn('access token expired');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tgetAccessToken = () => {\n\t\treturn window.localStorage.getItem('jwt_access_token');\n\t};\n}\n\nconst instance = new JwtService();\n\nexport default instance;\n"]},"metadata":{},"sourceType":"module"}