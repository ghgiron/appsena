{"ast":null,"code":"import FuseUtils from '@fuse/utils/FuseUtils';\nimport axios from 'axios';\nimport jwtDecode from 'jwt-decode';\n/* eslint-disable camelcase */\n\nclass JwtService extends FuseUtils.EventEmitter {\n  constructor(...args) {\n    super(...args);\n\n    this.setInterceptors = () => {\n      axios.interceptors.response.use(response => {\n        console.log(response);\n        return response;\n      }, err => {\n        return new Promise((resolve, reject) => {\n          if (err.response.status === 401 && err.config && !err.config.__isRetryRequest) {\n            // if you ever get an unauthorized response, logout the user\n            this.emit('onAutoLogout', 'Invalid access_token');\n            this.setSession(null);\n          }\n\n          throw err;\n        });\n      });\n    };\n\n    this.handleAuthentication = () => {\n      const access_token = this.getAccessToken();\n\n      if (!access_token) {\n        this.emit('onNoAccessToken');\n        return;\n      }\n\n      if (this.isAuthTokenValid(access_token)) {\n        this.setSession(access_token);\n        this.emit('onAutoLogin', true);\n      } else {\n        this.setSession(null);\n        this.emit('onAutoLogout', 'access_token expired');\n      }\n    };\n\n    this.createUser = data => {\n      return new Promise((resolve, reject) => {\n        axios.post('/api/auth/register', data).then(response => {\n          if (response.data.user) {\n            this.setSession(response.data.access_token);\n            resolve(response.data.user);\n          } else {\n            reject(response.data.error);\n          }\n        });\n      });\n    };\n\n    this.signInWithEmailAndPassword = (email, password) => {\n      return new Promise((resolve, reject) => {\n        axios.post('/api/auth', {\n          data: {\n            email,\n            password\n          }\n        }).then(response => {\n          if (response.data.user) {\n            this.setSession(response.data.access_token);\n            resolve(response.data.user);\n          } else {\n            reject(response.data.error);\n          }\n        });\n      });\n    };\n\n    this.signInWithToken = () => {\n      return new Promise((resolve, reject) => {\n        axios.get('/api/auth/access-token', {\n          data: {\n            access_token: this.getAccessToken()\n          }\n        }).then(response => {\n          if (response.data.user) {\n            this.setSession(response.data.access_token);\n            resolve(response.data.user);\n          } else {\n            this.logout();\n            reject(new Error('Failed to login with token.'));\n          }\n        }).catch(error => {\n          this.logout();\n          reject(new Error('Failed to login with token.'));\n        });\n      });\n    };\n\n    this.updateUserData = user => {\n      return axios.post('/api/auth/user/update', {\n        user\n      });\n    };\n\n    this.setSession = access_token => {\n      if (access_token) {\n        localStorage.setItem('jwt_access_token', access_token);\n        axios.defaults.headers.common.Authorization = `Bearer ${access_token}`;\n      } else {\n        localStorage.removeItem('jwt_access_token');\n        delete axios.defaults.headers.common.Authorization;\n      }\n    };\n\n    this.logout = () => {\n      this.setSession(null);\n    };\n\n    this.isAuthTokenValid = access_token => {\n      if (!access_token) {\n        return false;\n      }\n\n      const decoded = jwtDecode(access_token);\n      const currentTime = Date.now() / 1000;\n\n      if (decoded.exp < currentTime) {\n        console.warn('access token expired');\n        return false;\n      }\n\n      return true;\n    };\n\n    this.getAccessToken = () => {\n      return window.localStorage.getItem('jwt_access_token');\n    };\n  }\n\n  init() {\n    this.setInterceptors();\n    this.handleAuthentication();\n  }\n\n}\n\nconst instance = new JwtService();\nexport default instance;","map":{"version":3,"sources":["D:/proyectos_react/Proyecto_sena_desarrollo/src/app/services/jwtService/jwtService.js"],"names":["FuseUtils","axios","jwtDecode","JwtService","EventEmitter","setInterceptors","interceptors","response","use","console","log","err","Promise","resolve","reject","status","config","__isRetryRequest","emit","setSession","handleAuthentication","access_token","getAccessToken","isAuthTokenValid","createUser","data","post","then","user","error","signInWithEmailAndPassword","email","password","signInWithToken","get","logout","Error","catch","updateUserData","localStorage","setItem","defaults","headers","common","Authorization","removeItem","decoded","currentTime","Date","now","exp","warn","window","getItem","init","instance"],"mappings":"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","sourcesContent":["import FuseUtils from '@fuse/utils/FuseUtils';\nimport axios from 'axios';\nimport jwtDecode from 'jwt-decode';\n/* eslint-disable camelcase */\n\nclass JwtService extends FuseUtils.EventEmitter {\n\tinit() {\n\t\tthis.setInterceptors();\n\t\tthis.handleAuthentication();\n\t}\n\n\tsetInterceptors = () => {\n\t\taxios.interceptors.response.use(\n\t\t\tresponse => {\n\t\t\t\tconsole.log(response)\n\t\t\t\treturn response;\n\t\t\t},\n\t\t\terr => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tif (err.response.status === 401 && err.config && !err.config.__isRetryRequest) {\n\t\t\t\t\t\t// if you ever get an unauthorized response, logout the user\n\t\t\t\t\t\tthis.emit('onAutoLogout', 'Invalid access_token');\n\t\t\t\t\t\tthis.setSession(null);\n\t\t\t\t\t}\n\t\t\t\t\tthrow err;\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t};\n\n\thandleAuthentication = () => {\n\t\tconst access_token = this.getAccessToken();\n\n\t\tif (!access_token) {\n\t\t\tthis.emit('onNoAccessToken');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isAuthTokenValid(access_token)) {\n\t\t\tthis.setSession(access_token);\n\t\t\tthis.emit('onAutoLogin', true);\n\t\t} else {\n\t\t\tthis.setSession(null);\n\t\t\tthis.emit('onAutoLogout', 'access_token expired');\n\t\t}\n\t};\n\n\tcreateUser = data => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\taxios.post('/api/auth/register', data).then(response => {\n\t\t\t\tif (response.data.user) {\n\t\t\t\t\tthis.setSession(response.data.access_token);\n\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t} else {\n\t\t\t\t\treject(response.data.error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\tsignInWithEmailAndPassword = (email, password) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\taxios.post('/api/auth', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\temail,\n\t\t\t\t\t\tpassword\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\t\n\t\t\t\t\tif (response.data.user) {\n\t\t\t\t\t\tthis.setSession(response.data.access_token);\n\t\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t};\n\n\tsignInWithToken = () => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\taxios\n\t\t\t\t.get('/api/auth/access-token', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taccess_token: this.getAccessToken()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (response.data.user) {\n\t\t\t\t\t\tthis.setSession(response.data.access_token);\n\t\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.logout();\n\t\t\t\t\t\treject(new Error('Failed to login with token.'));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\tthis.logout();\n\t\t\t\t\treject(new Error('Failed to login with token.'));\n\t\t\t\t});\n\t\t});\n\t};\n\n\tupdateUserData = user => {\n\t\treturn axios.post('/api/auth/user/update', {\n\t\t\tuser\n\t\t});\n\t};\n\n\tsetSession = access_token => {\n\t\tif (access_token) {\n\t\t\tlocalStorage.setItem('jwt_access_token', access_token);\n\t\t\taxios.defaults.headers.common.Authorization = `Bearer ${access_token}`;\n\t\t} else {\n\t\t\tlocalStorage.removeItem('jwt_access_token');\n\t\t\tdelete axios.defaults.headers.common.Authorization;\n\t\t}\n\t};\n\n\tlogout = () => {\n\t\tthis.setSession(null);\n\t};\n\n\tisAuthTokenValid = access_token => {\n\t\tif (!access_token) {\n\t\t\treturn false;\n\t\t}\n\t\tconst decoded = jwtDecode(access_token);\n\t\tconst currentTime = Date.now() / 1000;\n\t\tif (decoded.exp < currentTime) {\n\t\t\tconsole.warn('access token expired');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tgetAccessToken = () => {\n\t\treturn window.localStorage.getItem('jwt_access_token');\n\t};\n}\n\nconst instance = new JwtService();\n\nexport default instance;\n"]},"metadata":{},"sourceType":"module"}